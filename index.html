<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Serial Example</title>
    <style>
        #terminal {
            width: 80%;
            height: 300px;
            border: 1px solid #ccc;
            overflow-y: scroll;
            padding: 10px;
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <h1>Web Serial Example</h1>
    <div id="terminal"></div>

    <script>
        let serialPort;
        const terminal = document.getElementById('terminal');

        async function connectSerial() {
            try {
                serialPort = await navigator.serial.requestPort();
                await serialPort.open({ baudrate: 115200 });
                readSerial();
            } catch (error) {
                console.error('Error connecting to serial port:', error);
            }
        }

        async function readSerial() {
            while (serialPort.readable) {
                const reader = serialPort.readable.getReader();
                try {
                    while (true) {
                        const { value, done } = await reader.read();
                        if (done) {
                            break;
                        }
                        const message = new TextDecoder().decode(value);
                        const messageElement = document.createElement('p');
                        messageElement.textContent = message;
                        terminal.appendChild(messageElement);
                        terminal.scrollTop = terminal.scrollHeight;
                    }
                } catch (error) {
                    console.error('Error reading from serial port:', error);
                } finally {
                    reader.releaseLock();
                }
            }
        }

        // Request permission to access the serial port
        document.getElementById('connectButton').addEventListener('click', connectSerial);
    </script>
</body>
</html>
